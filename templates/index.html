<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokémon Stats</title>
    <!-- Utilisation de url_for pour lier le fichier CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script>
      // Fonction pour récupérer les statistiques du Pokémon
      async function fetchPokemonStats() {
        const pokemonName = document.getElementById("pokemon-input").value;
        const response = await fetch(`/pokemon/${pokemonName}`);
        const data = await response.json();

        const resultDiv = document.getElementById("result-single");
        if (response.status === 200) {
          resultDiv.innerHTML = `
                    <h3>Statistiques de ${data.name}</h3>
                    <p><strong>HP:</strong> ${data.hp}</p>
                    <p><strong>Attaque:</strong> ${data.attack}</p>
                    <p><strong>Défense:</strong> ${data.defense}</p>
                `;
        } else {
          resultDiv.innerHTML = `<p>${data.error}</p>`;
        }
      }

      // Fonction pour comparer deux Pokémon
      async function comparePokemons() {
        const pokemon1 = document.getElementById("pokemon1-input").value;
        const pokemon2 = document.getElementById("pokemon2-input").value;
        const response = await fetch("/compare", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            pokemon1: pokemon1,
            pokemon2: pokemon2,
          }),
        });
        const data = await response.json();

        const resultDiv = document.getElementById("result-compare");
        if (response.status === 200) {
          resultDiv.innerHTML = `
                    <h3>Comparaison des Pokémon</h3>
                    <p><strong>${data.pokemon1.name}</strong> - HP: ${data.pokemon1.hp}, Attaque: ${data.pokemon1.attack}</p>
                    <p><strong>${data.pokemon2.name}</strong> - HP: ${data.pokemon2.hp}, Attaque: ${data.pokemon2.attack}</p>
                    <p><strong>Le plus fort:</strong> ${data.stronger}</p>
                `;
        } else {
          resultDiv.innerHTML = `<p>${data.error}</p>`;
        }
      }

      // Fonction pour récupérer les informations sur un type de Pokémon
      async function fetchPokemonByType() {
        const typeName = document.getElementById("type-input").value;
        const response = await fetch(`/type/${typeName}`);
        const data = await response.json();

        const resultDiv = document.getElementById("result-type");
        if (response.status === 200) {
          resultDiv.innerHTML = `
                <h3>Statistiques du type ${data.type}</h3>
                <p><strong>Nombre de Pokémon:</strong> ${data.pokemon_count}</p>
                <p><strong>Moyenne des HP:</strong> ${data.average_hp}</p>
                <h4>Efficacité contre d'autres types:</h4>
                <p><strong>Double dégâts contre:</strong> ${data.effectiveness.double_damage_to.join(
                  ", "
                )}</p>
                <p><strong>Dégâts réduits contre:</strong> ${data.effectiveness.half_damage_to.join(
                  ", "
                )}</p>
                <p><strong>Aucun dégât contre:</strong> ${data.effectiveness.no_damage_to.join(
                  ", "
                )}</p>
            `;
        } else {
          resultDiv.innerHTML = `<p>${data.error}</p>`;
        }
      }

      // Fonction pour simuler un combat entre deux Pokémon
      async function simulateBattle() {
        const pokemon1 = document.getElementById("battle-pokemon1-input").value;
        const pokemon2 = document.getElementById("battle-pokemon2-input").value;

        const stats1 = await fetchPokemonStatsForBattle(pokemon1);
        const stats2 = await fetchPokemonStatsForBattle(pokemon2);

        if (!stats1 || !stats2) {
          const resultDiv = document.getElementById("result-battle");
          resultDiv.innerHTML = `<p>Un ou les deux Pokémon n'ont pas été trouvés</p>`;
          return;
        }

        let pokemon1Damage = 0;
        let pokemon2Damage = 0;

        for (let turn = 1; turn <= 5; turn++) {
          pokemon1Damage += stats1.attack; // Pokémon 1 attacks
          pokemon2Damage += stats2.attack; // Pokémon 2 attacks
        }

        const resultDiv = document.getElementById("result-battle");
        const winner = pokemon1Damage > pokemon2Damage ? pokemon1 : pokemon2;
        resultDiv.innerHTML = `
          <h3>Résultat du combat</h3>
          <p><strong>${pokemon1}</strong> a infligé ${pokemon1Damage} points de dégâts.</p>
          <p><strong>${pokemon2}</strong> a infligé ${pokemon2Damage} points de dégâts.</p>
          <p><strong>Le gagnant est:</strong> ${winner}</p>
        `;
      }

      // Fonction pour récupérer les statistiques du Pokémon pour le combat
      async function fetchPokemonStatsForBattle(pokemon) {
        const response = await fetch(`/pokemon/${pokemon}`);
        if (response.status === 200) {
          const data = await response.json();
          return {
            name: data.name,
            attack: data.attack,
          };
        }
        return null; // Pokémon not found
      }
    </script>
  </head>
  <body>
    <h1>Welcome to PokéVerse!</h1>

    <!-- Search Pokémon by id or name -->
    <section>
      <h2>Get Pokémon Stats</h2>
      <input
        type="text"
        id="pokemon-input"
        placeholder="Enter name or ID of Pokémon"
      />
      <button onclick="fetchPokemonStats()">See Statistiques</button>
      <div id="result-single"></div>
    </section>

    <hr />

    <!-- Comparing two Pokémon -->
    <section>
      <h2>Compare Two Pokémon</h2>
      <input
        type="text"
        id="pokemon1-input"
        placeholder="Enter the name or ID of the first Pokémon"
      />
      <input
        type="text"
        id="pokemon2-input"
        placeholder="Enter the name or ID of the second Pokémon"
      />
      <button onclick="comparePokemons()">Compare</button>
      <div id="result-compare"></div>
    </section>

    <hr />

    <!-- Search Pokémon by type -->
    <section>
      <h2>Get Pokémon Type Info</h2>
      <input
        type="text"
        id="type-input"
        placeholder="Enter type of Pokémon (e.g., fire, water)"
      />
      <button onclick="fetchPokemonByType()">See Type Info</button>
      <div id="result-type"></div>
    </section>

    <hr />

    <!-- Simulating a battle between two Pokémon -->
    <section>
      <h2>Simulate Pokémon Battle</h2>
      <input
        type="text"
        id="battle-pokemon1-input"
        placeholder="Enter the name or ID of the first Pokémon"
      />
      <input
        type="text"
        id="battle-pokemon2-input"
        placeholder="Enter the name or ID of the second Pokémon"
      />
      <button onclick="simulateBattle()">Simulate Battle</button>
      <div id="result-battle"></div>
    </section>
  </body>
</html>
